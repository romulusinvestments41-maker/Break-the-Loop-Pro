<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Break The Loop Pro - AI-Powered Pattern Breaking</title>
    <meta name="description" content="World-class loop breaking powered by AI. Identify negative mental patterns with eerie accuracy and replace them with empowering thoughts and micro actions.">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .pro-badge {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .header p {
            font-size: 1.15rem;
            opacity: 0.95;
            font-weight: 300;
            margin-bottom: 8px;
        }

        .header .subtext {
            font-size: 0.9rem;
            opacity: 0.85;
            font-style: italic;
        }

        .main-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e0e7ff;
            color: #667eea;
        }

        .message-content {
            background: #f8fafc;
            padding: 16px 20px;
            border-radius: 16px;
            max-width: 70%;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-content {
            background: #f1f5f9;
            color: #1e293b;
        }

        .input-container {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
        }

        .welcome-screen {
            text-align: center;
            padding: 60px 40px;
            color: #64748b;
        }

        .welcome-screen h2 {
            font-size: 28px;
            color: #1e293b;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .welcome-screen p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
            text-align: left;
        }

        .feature-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .feature-card h3 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .feature-card p {
            font-size: 14px;
            color: #64748b;
            margin: 0;
            line-height: 1.5;
        }

        .starter-prompts {
            display: grid;
            gap: 12px;
            margin-top: 30px;
        }

        .starter-prompt {
            padding: 16px 20px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 15px;
            color: #475569;
        }

        .starter-prompt:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .api-setup {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .api-setup h3 {
            color: #92400e;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .api-setup p {
            font-size: 14px;
            color: #92400e;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .api-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Monaco', 'Courier New', monospace;
            margin-top: 8px;
        }

        .api-save-button {
            margin-top: 12px;
            padding: 10px 20px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .api-save-button:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .footer-note {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 13px;
            opacity: 0.8;
        }

        .footer-note a {
            color: white;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 8px;
            }
            
            .message-content {
                max-width: 85%;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Complete system prompt with 7-stage protocol
        const SYSTEM_PROMPT = `You are "Break The Loop Pro" - an elite AI loop-breaking coach.

CRITICAL MISSION: Identify negative mental loops with 100% accuracy and replace them with empowering thoughts and micro actions.

EXECUTE THIS 7-STAGE PROTOCOL:

STAGE 1: INITIAL ENGAGEMENT
- Build rapport and gather context
- Begin pattern recognition
- Create safety for honest disclosure

STAGE 2: STRATEGIC QUESTIONING (5-8 questions minimum)
Layer 1: "When does this show up?" "What happens right before?"
Layer 2: "What do you tell yourself?" "If you keep this pattern, where does it lead?"
Layer 3: "When is the first time you felt this?" "What did you learn about yourself then?"
Layer 4: "What does it mean about you when this happens?" "What are you afraid will happen?"

DO NOT proceed to loop naming until you have enough data.

STAGE 3: SOMATIC INQUIRY
Ask: "Where do you feel this in your body?" (chest, throat, stomach, shoulders, etc.)
Get specific: "Is it tension? Tightness? Heaviness?"

STAGE 4: LOOP NAMING (CRITICAL - MUST BE EERILY ACCURATE)
Synthesize everything into ONE powerful statement that captures:
- The trigger
- The core belief
- The behavior
- The paradox (how the solution becomes the problem)
- The origin

Example: "You pre-emptively reject yourself before anyone else can, so you stay in control of the pain - but it means you never let anyone actually see you, which guarantees the isolation you fear most."

ALWAYS ask: "Does that resonate?" If they say no or hesitate, ask more questions and refine.

STAGE 5: ORIGIN EXPLORATION
Connect the loop to childhood: "This pattern protected you when you were [age] and [situation]. It was brilliant survival strategy then. But what protected you then is limiting you now."

STAGE 6: PHYSICAL INTERRUPTION PROTOCOL
Say: "We're going to interrupt this loop right now. Follow this sequence:"

STEP 1: "Take a slow breath in through your nose for 4 counts... Hold for 2... Exhale slowly through your mouth for 6 counts. Do this 3 times."

STEP 2: Physical Anchor (based on where they feel it):
- Chest: "Place your hand on your heart. Feel the warmth. Gently tap or rub small circles"
- Stomach: "Place both hands on your stomach. Press gently. Feel yourself grounded"
- Throat: "Gently massage the sides of your neck. Roll your shoulders back"
- Shoulders: "Roll your shoulders back 3 times. Shake out your arms"

STEP 3: New Mental Implant: "Now say this out loud: [empowering thought that counters their loop]"

STAGE 7: MICRO ACTION PLAN
Ask about their goals, then create 2-5 SPECIFIC micro actions:
- Must be specific and measurable
- Must directly counter the loop
- Must connect to their stated goals
- Must be achievable (2-5 minutes)

Example: "When you feel the urge to test someone, wait 10 minutes. Use that time to do the breathing. Then decide if you still need to text."

Ask: "Would you like me to create a tracker for these actions?"

TONE: Compassionate but direct. You care about the person, but you confront the pattern.

NEVER:
- Move to next stage until current is complete
- Guess at loops - ask more questions
- Use generic language - be surgically specific
- Skip the breathing protocol
- Create vague micro actions

Your goal: User says "Holy shit, how did you know that?" after loop naming.

You are Break The Loop Pro - the world's most accurate pattern recognition system.`;

        function App() {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [apiKey, setApiKey] = useState('');
            const [showApiSetup, setShowApiSetup] = useState(true);
            const [conversationHistory, setConversationHistory] = useState([]);
            const chatEndRef = useRef(null);

            useEffect(() => {
                const savedKey = localStorage.getItem('anthropic_api_key');
                if (savedKey) {
                    setApiKey(savedKey);
                    setShowApiSetup(false);
                }
            }, []);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const saveApiKey = () => {
                localStorage.setItem('anthropic_api_key', apiKey);
                setShowApiSetup(false);
            };

            const starterPrompts = [
                "I keep sabotaging myself when things are going well",
                "I can't stop people-pleasing even though it's exhausting",
                "I procrastinate on everything important",
                "I'm stuck in a negative pattern and need help breaking it"
            ];

            const sendMessage = async (messageText = input) => {
                if (!messageText.trim() || loading) return;
                if (!apiKey) {
                    alert('Please enter your Anthropic API key first');
                    setShowApiSetup(true);
                    return;
                }

                const userMessage = { role: 'user', content: messageText };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setLoading(true);

                const newHistory = [...conversationHistory, userMessage];

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            system: SYSTEM_PROMPT,
                            messages: newHistory
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    const assistantMessage = {
                        role: 'assistant',
                        content: data.content[0].text
                    };

                    setMessages(prev => [...prev, assistantMessage]);
                    setConversationHistory([...newHistory, assistantMessage]);
                } catch (error) {
                    console.error('Error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: `I encountered an error: ${error.message}. Please check your API key and try again.`
                    }]);
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            const renderMessage = (message, index) => {
                const isUser = message.role === 'user';
                
                return (
                    <div key={index} className={`message ${message.role}`}>
                        <div className="message-avatar">
                            {isUser ? 'Y' : 'P'}
                        </div>
                        <div className="message-content">
                            {message.content}
                        </div>
                    </div>
                );
            };

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>
                            Break The Loop
                            <span className="pro-badge">PRO</span>
                        </h1>
                        <p>World-class loop breaking powered by AI</p>
                        <p className="subtext">Your patterns aren't permanent. They're just practiced.</p>
                    </div>

                    <div className="main-card">
                        <div className="chat-container">
                            {showApiSetup && (
                                <div className="api-setup">
                                    <h3>ðŸ”‘ Setup Required</h3>
                                    <p>
                                        To use Break The Loop Pro, you need an Anthropic API key. 
                                        Get one at <a href="https://console.anthropic.com" target="_blank" rel="noopener" style={{color: '#92400e', fontWeight: 'bold'}}>console.anthropic.com</a>
                                    </p>
                                    <p style={{fontSize: '13px', fontStyle: 'italic', marginTop: '8px'}}>
                                        Your key is stored locally and only sent to Anthropic's API.
                                    </p>
                                    <input
                                        type="password"
                                        className="api-input"
                                        placeholder="sk-ant-..."
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                    />
                                    <button className="api-save-button" onClick={saveApiKey}>
                                        Save & Start Breaking Loops
                                    </button>
                                </div>
                            )}

                            {messages.length === 0 && !showApiSetup && (
                                <div className="welcome-screen">
                                    <h2>Stuck in the same pattern? Let's break it.</h2>
                                    <p>
                                        <strong>Mental loops</strong> are negative patterns that keep repeatingâ€”perfectionism, 
                                        people-pleasing, self-sabotage, procrastination. I'll help you identify yours with 
                                        eerie accuracy and give you exact steps to replace it.
                                    </p>
                                    
                                    <p style={{fontSize: '15px', color: '#475569', marginTop: '12px'}}>
                                        <strong>What happens:</strong> I'll ask strategic questions to understand your pattern, 
                                        name it precisely, trace where it came from, then guide you through breaking it with 
                                        breathing, anchoring, and micro actions you can do today.
                                    </p>

                                    <div className="feature-grid">
                                        <div className="feature-card">
                                            <h3>ðŸŽ¯ Eerily Accurate</h3>
                                            <p>CBT + Schema Therapy + Jungian psychology + somatic work</p>
                                        </div>
                                        <div className="feature-card">
                                            <h3>ðŸ§  Evidence-Based</h3>
                                            <p>Built on 50+ clinical studies across 10+ therapeutic modalities</p>
                                        </div>
                                        <div className="feature-card">
                                            <h3>âš¡ Immediately Actionable</h3>
                                            <p>4-2-6 breathing + body anchoring + specific micro actions</p>
                                        </div>
                                    </div>

                                    <p style={{fontSize: '14px', fontStyle: 'italic', marginTop: '30px', color: '#64748b'}}>
                                        <strong>For anyone stuck in:</strong> Perfectionism â€¢ People-pleasing â€¢ Self-sabotage â€¢ 
                                        Procrastination â€¢ Negative self-talk â€¢ Relationship patterns
                                    </p>

                                    <p style={{fontSize: '14px', fontWeight: '600', marginTop: '20px', color: '#1e293b'}}>
                                        Choose a starting point or share what's on your mind:
                                    </p>
                                    <div className="starter-prompts">
                                        {starterPrompts.map((prompt, i) => (
                                            <div
                                                key={i}
                                                className="starter-prompt"
                                                onClick={() => sendMessage(prompt)}
                                            >
                                                {prompt}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {messages.map(renderMessage)}

                            {loading && (
                                <div className="message assistant">
                                    <div className="message-avatar">P</div>
                                    <div className="loading">
                                        <div className="loading-dot"></div>
                                        <div className="loading-dot"></div>
                                        <div className="loading-dot"></div>
                                    </div>
                                </div>
                            )}

                            <div ref={chatEndRef} />
                        </div>

                        <div className="input-container">
                            <div className="input-wrapper">
                                <textarea
                                    className="chat-input"
                                    placeholder="Share what's on your mind..."
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    disabled={loading || showApiSetup}
                                />
                            </div>
                            <button
                                className="send-button"
                                onClick={() => sendMessage()}
                                disabled={loading || !input.trim() || showApiSetup}
                            >
                                Send
                            </button>
                        </div>
                    </div>

                    <div className="footer-note">
                        Powered by Claude AI â€¢ Built on research from 50+ clinical studies
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
